
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>Robot Controller</title>
	
	<!-- JQuery JavaScript -->
    <script src="./js/jquery.min.js"></script>
	
	<!-- Blockly core imports -->
	<script src="./blockly/blockly_compressed.js"></script>
	<script src="./blockly/blocks_compressed.js"></script>
	<script src="./blockly/msg/js/en.js"></script>
	<script src="./blockly/storage.js"></script>
	
	<!-- Blockly JS code generator -->
	<script src="./blockly/javascript_compressed.js"></script>
	
	<!-- JS Interpreter -->
	<script src="./js_interpreter/acorn_interpreter.js"></script>
	
	<!-- Blockly custom imports -->
	<script src="./blockly/blocks/pirobot.js"></script>
	<script src="./blockly/generators/javascript/pirobot.js"></script>
	
	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		
		body {
			background-color: #fff;
			font-family: sans-serif;
			overflow: hidden;
		}
		
		h1 {
			font-weight: normal;
			font-size: 140%;
		}
		
		table {
			height: 100%;
			width: 100%;
			margin: 0px;
		}
		
		#blocklyArea {
			height: 99%;
		}
	</style>
</head>
<body>
	<table>
		<tr>
			<td>
				<table>
					<tr>
						<td><h1>Robot Controller</h1></td>
						<td>
							<button onclick="javascript:BlocklyPi.executeBlocklyWorkspace()">Start</button>
							<button onclick="javascript:BlocklyPi.debugBlocklyWorkspace()">Debug</button>
							<button onclick="javascript:BlocklyPi.stopBlocklyWorkspace()">Stop</button>
						</td>
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td id="blocklyArea"></td>
		</tr>
	</table>

	<div id="blocklyDiv" style="position: absolute"></div>

	<xml id="toolbox" style="display: none">
	   <category id="catLogic" name="Logic">
	     <block type="controls_if"></block>
	     <block type="logic_compare"></block>
	     <block type="logic_operation"></block>
	     <block type="logic_negate"></block>
	     <block type="logic_boolean"></block>
	     <block type="logic_null"></block>
	     <block type="logic_ternary"></block>
	   </category>
	   <category id="catLoops" name="loops">
	     <block type="controls_repeat_ext">
	       <value name="TIMES">
	         <block type="math_number">
	           <field name="NUM">10</field>
	         </block>
	       </value>
	     </block>
	     <block type="controls_whileUntil"></block>
	     <block type="controls_for">
	       <value name="FROM">
	         <block type="math_number">
	           <field name="NUM">1</field>
	         </block>
	       </value>
	       <value name="TO">
	         <block type="math_number">
	           <field name="NUM">10</field>
	         </block>
	       </value>
	       <value name="BY">
	         <block type="math_number">
	           <field name="NUM">1</field>
	         </block>
	       </value>
	     </block>
	     <block type="controls_forEach"></block>
	     <block type="controls_flow_statements"></block>
	   </category>
	   <category id="catMath" name="Math">
	     <block type="math_number"></block>
	     <block type="math_arithmetic"></block>
	     <block type="math_single"></block>
	     <block type="math_trig"></block>
	     <block type="math_constant"></block>
	     <block type="math_number_property"></block>
	     <block type="math_change">
	       <value name="DELTA">
	         <block type="math_number">
	           <field name="NUM">1</field>
	         </block>
	       </value>
	     </block>
	     <block type="math_round"></block>
	     <block type="math_on_list"></block>
	     <block type="math_modulo"></block>
	     <block type="math_constrain">
	       <value name="LOW">
	         <block type="math_number">
	           <field name="NUM">1</field>
	         </block>
	       </value>
	       <value name="HIGH">
	         <block type="math_number">
	           <field name="NUM">100</field>
	         </block>
	       </value>
	     </block>
	     <block type="math_random_int">
	       <value name="FROM">
	         <block type="math_number">
	           <field name="NUM">1</field>
	         </block>
	       </value>
	       <value name="TO">
	         <block type="math_number">
	           <field name="NUM">100</field>
	         </block>
	       </value>
	     </block>
	     <block type="math_random_float"></block>
	   </category>
	   <category id="catText" name="Text">
	     <block type="text"></block>
	     <block type="text_print"></block>
	     <block type="text_join"></block>
	     <block type="text_append">
	       <value name="TEXT">
	         <block type="text"></block>
	       </value>
	     </block>
	     <block type="text_length"></block>
	     <block type="text_isEmpty"></block>
	     <block type="text_indexOf">
	       <value name="VALUE">
	         <block type="variables_get">
	           <field name="VAR" class="textVar">...</field>
	         </block>
	       </value>
	     </block>
	     <block type="text_charAt">
	       <value name="VALUE">
	         <block type="variables_get">
	           <field name="VAR" class="textVar">...</field>
	         </block>
	       </value>
	     </block>
	     <block type="text_getSubstring">
	       <value name="STRING">
	         <block type="variables_get">
	           <field name="VAR" class="textVar">...</field>
	         </block>
	       </value>
	     </block>
	     <block type="text_changeCase"></block>
	     <block type="text_trim"></block>
	     <block type="text_prompt_ext">
	       <value name="TEXT">
	         <block type="text"></block>
	       </value>
	     </block>
	   </category>
	   <category id="catLists" name="Lists">
	     <block type="lists_create_empty"></block>
	     <block type="lists_create_with"></block>
	     <block type="lists_repeat">
	       <value name="NUM">
	         <block type="math_number">
	           <field name="NUM">5</field>
	         </block>
	       </value>
	     </block>
	     <block type="lists_length"></block>
	     <block type="lists_isEmpty"></block>
	     <block type="lists_indexOf">
	       <value name="VALUE">
	         <block type="variables_get">
	           <field name="VAR" class="listVar">...</field>
	         </block>
	       </value>
	     </block>
	     <block type="lists_getIndex">
	       <value name="VALUE">
	         <block type="variables_get">
	           <field name="VAR" class="listVar">...</field>
	         </block>
	       </value>
	     </block>
	     <block type="lists_setIndex">
	       <value name="LIST">
	         <block type="variables_get">
	           <field name="VAR" class="listVar">...</field>
	         </block>
	       </value>
	     </block>
	     <block type="lists_getSublist">
	       <value name="LIST">
	         <block type="variables_get">
	           <field name="VAR" class="listVar">...</field>
	         </block>
	       </value>
	     </block>
	     <block type="lists_split">
	       <value name="DELIM">
	         <block type="text">
	           <field name="TEXT">,</field>
	         </block>
	       </value>
	     </block>
	   </category>
	   <sep></sep>
	   <category id="robotCat" name="Robot">
	   	<block type="robot_motor_power">
	       <value name="POWER">
	         <block type="math_number">
	           <field name="NUM">100</field>
	         </block>
	       </value>
	     </block>
	     <block type="robot_reset"></block>
	   </category>
	   <category id="keyCat" name="Keys">
	   	<block type="control_key_down"></block>
	   </category>
	   
	   <sep></sep>
	   <category id="catVariables" custom="VARIABLE" name="Variables"></category>
	   <category id="catFunctions" custom="PROCEDURE" name="Functions"></category>
	</xml>

    
	<!-- Init Blockly JavaScript
    ================================================== -->
	<script>
		
		var gridSettings = { spacing: 20, length: 3, colour: '#ccc', snap: true};
		var toolboxSettings = document.getElementById('toolbox'); 
	
	    var blocklyArea = document.getElementById('blocklyArea');
	    var blocklyDiv = document.getElementById('blocklyDiv');
	    window.blocklyWorkspace = Blockly.inject(blocklyDiv, {media: './blockly/media/', toolbox: toolboxSettings, grid: gridSettings});
	    var onresize = function(e) {
	      // Compute the absolute coordinates and dimensions of blocklyArea.
	      var element = blocklyArea;
	      var x = 0;
	      var y = 0;
	      do {
	        x += element.offsetLeft;
	        y += element.offsetTop;
	        element = element.offsetParent;
	      } while (element);
	      // Position blocklyDiv over blocklyArea.
	      blocklyDiv.style.left = x + 'px';
	      blocklyDiv.style.top = y + 'px';
	      blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
	      blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
	    };
	    window.addEventListener('resize', onresize, false);
	    onresize();
	    
	    // Reload the blocks from last time.
	    // window.setTimeout(BlocklyStorage.restoreBlocks, 0);
	    // Back them up on unloading
	    // BlocklyStorage.backupOnUnload()
	</script>
  
	<!-- Custom JS
	================================================== -->
	<script src="./js/blocklypi.js"></script>
	
</body>
</html>
